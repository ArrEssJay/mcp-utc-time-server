[supervisord]
nodaemon=true
user=root
loglevel=info

[program:ntpd]
command=/usr/sbin/ntpd -g -n -u ntpsec:ntpsec
priority=1
autostart=true
autorestart=true
startretries=10
startsecs=5
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:mcp-server]
command=/usr/local/bin/mcp-utc-time-server
priority=10
autostart=true
autorestart=true
startretries=3
startsecs=10
user=appuser
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=RUST_LOG="%(ENV_RUST_LOG)s",PORT="%(ENV_PORT)s"

[eventlistener:processes]
command=sh -c "printf 'READY\n' && while read line; do kill -SIGTERM $(cat /var/run/supervisord.pid); done < /dev/stdin"
events=PROCESS_STATE_FATAL
